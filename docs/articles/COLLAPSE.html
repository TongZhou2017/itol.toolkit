<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>COLLAPSE • itol.toolkit</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="COLLAPSE">
<meta property="og:description" content="itol.toolkit">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">itol.toolkit</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.8</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/Get_Start.html">Get started</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Single Functions
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Tree Structure</li>
    <li>
      <a href="../articles/COLLAPSE.html">COLLAPSE</a>
    </li>
    <li>
      <a href="../articles/PRUNE.html">PRUNE</a>
    </li>
    <li>
      <a href="../articles/SPACING.html">SPACING</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Theme Style</li>
    <li>
      <a href="../articles/TREE_COLORS.html">TREE_COLORS</a>
    </li>
    <li>
      <a href="../articles/DATASET_STYLE.html">DATASET_STYLE</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Text</li>
    <li>
      <a href="../articles/LABELS.html">LABELS</a>
    </li>
    <li>
      <a href="../articles/DATASET_TEXT.html">DATASET_TEXT</a>
    </li>
    <li>
      <a href="../articles/DATASET_COLORSTRIP.html">DATASET_COLORSTRIP</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Basic Plot</li>
    <li>
      <a href="../articles/DATASET_BINARY.html">DATASET_BINARY</a>
    </li>
    <li>
      <a href="../articles/DATASET_GRADIENT.html">DATASET_GRADIENT</a>
    </li>
    <li>
      <a href="../articles/DATASET_HEATMAP.html">DATASET_HEATMAP</a>
    </li>
    <li>
      <a href="../articles/DATASET_SYMBOL.html">DATASET_SYMBOL</a>
    </li>
    <li>
      <a href="../articles/DATASET_EXTERNALSHAPE.html">DATASET_EXTERNALSHAPE</a>
    </li>
    <li>
      <a href="../articles/DATASET_DOMAINS.html">DATASET_DOMAINS</a>
    </li>
    <li>
      <a href="../articles/DATASET_SIMPLEBAR.html">DATASET_SIMPLEBAR</a>
    </li>
    <li>
      <a href="../articles/DATASET_MULTIBAR.html">DATASET_MULTIBAR</a>
    </li>
    <li>
      <a href="../articles/DATASET_BOXPLOT.html">DATASET_BOXPLOT</a>
    </li>
    <li>
      <a href="../articles/DATASET_LINECHART.html">DATASET_LINECHART</a>
    </li>
    <li>
      <a href="../articles/DATASET_PIECHART.html">DATASET_PIECHART</a>
    </li>
    <li class="divider">
    </li>
<li class="dropdown-header">Advanced Plot</li>
    <li>
      <a href="../articles/DATASET_ALIGNMENT.html">DATASET_ALIGNMENT</a>
    </li>
    <li>
      <a href="../articles/DATASET_CONNECTIONS.html">DATASET_CONNECTIONS</a>
    </li>
    <li>
      <a href="../articles/DATASET_IMAGE.html">DATASET_IMAGE</a>
    </li>
    <li>
      <a href="../articles/POPUP_INFO.html">POPUP_INFO</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Tips
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/OVERVIEW_TREE_STRUCTURE.html">Overview</a>
    </li>
    <li>
      <a href="../articles/Installation.html">Installation</a>
    </li>
    <li>
      <a href="../articles/Datasets.html">Datasets</a>
    </li>
    <li>
      <a href="../articles/Color_Palette.html">Colors</a>
    </li>
    <li>
      <a href="../articles/Data_Reproduction.html">Data Reproduction</a>
    </li>
    <li>
      <a href="../articles/Comparison_table2itol.html">vs table2itol</a>
    </li>
    <li>
      <a href="../articles/tree_construction.html">Tree Construction</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://tongzhou2017.github.io/itol.toolkit-gallery/" class="external-link">Gallery</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/TongZhou2017/itol.toolkit" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://discord.com/invite/n5TC7jCfGJ" class="external-link">
    <span class="fab fa-discord fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://twitter.com/itol_toolkit" class="external-link">
    <span class="fa fa-twitter"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>COLLAPSE</h1>
                        <h4 data-toc-skip class="author">Weiyue Liu<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>, Zhongyi
Hua<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>,
Tong Zhou<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>
</h4>
            
      
      
      <div class="hidden name"><code>COLLAPSE.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>COLLAPSE</code> template are used to collapse branches.</p>
<p>Typically, The user merges branches A and B by folding them at their
most recent common ancestor (MRCA). However, it is normally hard for
users to declare the MRCA node directly. The node name is usually
generated automatically by software rather than specified by the user
when building the phylogenetic tree. Some programs do not even generate
the node name.</p>
<p>This section has taken these complicated cases into account, and
provide the corresponding solution, so that users can easily prepare the
input data.</p>
</div>
<div class="section level2">
<h2 id="range-id">Range ID<a class="anchor" aria-label="anchor" href="#range-id"></a>
</h2>
<p>This basic grammar for range id is written as:
<code>branch_A|branch_B</code>.</p>
<p>This section provides an example of how to collapse branches using <a href="https://github.com/TongZhou2017/itol.toolkit/tree/master/inst/extdata/dataset1" class="external-link">dataset
1</a> (refer to the <a href="https://tongzhou2017.github.io/itol.toolkit/articles/Datasets.html" class="external-link">Dataset</a>
for detail information) document for detailed information). Users can
download the data locally from the provided link above. The files are
read using a relative path in this document, so please adjust the path
based on actual situation.</p>
<p>The first step is to load the <code>newick</code> format tree file
<code>tree_of_itol_templates.tree</code> and its corresponding metadata
<code>template_groups</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">itol.toolkit</span><span class="op">)</span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,</span>
<span>                    <span class="st">"tree_of_itol_templates.tree"</span>,</span>
<span>                    package <span class="op">=</span> <span class="st">"itol.toolkit"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"template_groups"</span><span class="op">)</span></span></code></pre></div>
<p>Suppose that the user wants to collapse
<code>DATASET_SIMPLEBAR</code> and <code>DATASET_MULTIBAR</code> into
one branch; <code>DATASET_TEXT</code> and <code>LABELS</code> into
another branch;<code>DATASET_ALIGNMENT</code>,
<code>DATASET_CONNECTIONS</code>, <code>DATASET_IMAGE</code> and
<code>POPUP_INFO</code> which belong to advanced visualization into one
branch:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">range_ids</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DATASET_SIMPLEBAR|DATASET_MULTIBAR"</span>,</span>
<span>               <span class="st">"DATASET_TEXT|LABELS"</span>,</span>
<span>               <span class="st">"DATASET_CONNECTIONS|POPUP_INFO"</span><span class="op">)</span></span>
<span><span class="va">unit_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_unit.html">create_unit</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">range_ids</span>, </span>
<span>                      key <span class="op">=</span> <span class="st">"E001_collapse_1"</span>, </span>
<span>                      type <span class="op">=</span> <span class="st">"COLLAPSE"</span>, </span>
<span>                      tree <span class="op">=</span> <span class="va">tree</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/write_unit.html">write_unit</a></span><span class="op">(</span><span class="va">unit_1</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"/E001_collapse_1.txt"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/COLLAPSE_1.png"></p>
<p>While the first two sets of folded branches are relatively simple to
define because no other branches exist between them, the third set of
folded branches is slightly complex, requiring the user to select the
two branches with the longest spacing among the four to accurately
describe the extent to be folded. Writing the code as
<code>DATASET_ALIGNMENT | POPUP_INFO</code> may result in the omission
of the <code>DATASET_CONNECTIONS</code> branch, because the branch does
not belong to MCRA of <code>DATASET_ALIGNMENT</code> and
<code>POPUP_INFO</code>.</p>
<p>Because the process of defining branches is very cumbersome and
requires manual judgment, this function is not used frequently in the 23
templates in iTOL v6.</p>
</div>
<div class="section level2">
<h2 id="node-id">Node ID<a class="anchor" aria-label="anchor" href="#node-id"></a>
</h2>
<p>Although we used a tip label in the above example, using node names
directly is more convenient if it is available. Thus, the
<code>itol.toolkit</code> also enable you to define the collapsed branch
using the node name directly .</p>
<p>The tree provided by <code>itol.toolkit</code> <a href="https://github.com/TongZhou2017/itol.toolkit/blob/master/inst/extdata/dataset1/itol_templates.tree" class="external-link">dataset
1</a> including the node labels:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ape</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/read.tree.html" class="external-link">read.tree</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span></span>
<span><span class="co"># Phylogenetic tree with 23 tips and 22 internal nodes.</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># Tip labels:</span></span>
<span><span class="co">#   SPACING, COLLAPSE, PRUNE, TREE_COLORS, DATASET_STYLE, DATASET_CONNECTIONS, ...</span></span>
<span><span class="co"># Node labels:</span></span>
<span><span class="co">#   I1, I2, tree_sturcture, I4, theme_style, I6, ...</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Rooted; includes branch lengths.</span></span></code></pre></div>
<p>Therefore, you could specify the group you want to merge
directly.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">group_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tree_sturcture"</span>, <span class="st">"theme_style"</span>, <span class="st">"text"</span>, <span class="st">"basic_plot"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">unit_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_unit.html">create_unit</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">group_names</span>, </span>
<span>                      key <span class="op">=</span> <span class="st">"E002_collapse_2"</span>, </span>
<span>                      type <span class="op">=</span> <span class="st">"COLLAPSE"</span>, </span>
<span>                      tree <span class="op">=</span> <span class="va">tree</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/write_unit.html">write_unit</a></span><span class="op">(</span><span class="va">unit_2</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">"/E002_collapse_2.txt"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="images/COLLAPSE_2.png"></p>
<p>If you have questions about how to upload results files from iTOL
toolkit for interactive visualization on iTOL, please refer to the <a href="https://tongzhou2017.github.io/itol.toolkit/articles/Operation.html" class="external-link">Operation</a>
document for step-by-step guidance.</p>
</div>
<div class="footnotes footnotes-end-of-document">
<hr>
<ol>
<li id="fn1"><p>IOCAS, <a href="mailto:weiyLiu@outlook.com" class="email">weiyLiu@outlook.com</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>CACMS, <a href="mailto:njbxhzy@hotmail.com" class="email">njbxhzy@hotmail.com</a><a href="#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>IOCAS, <a href="mailto:tongzhou2017@gmail.com" class="email">tongzhou2017@gmail.com</a><a href="#fnref3" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Tong Zhou.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
